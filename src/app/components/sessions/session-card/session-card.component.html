<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}">
  <img src="assets/images/{{getSessionTypeIcon(session.type)}}.png" alt="" title="" />
  &nbsp;
  <span class="{{session.status === eSessionStatus.active ? 'strong' : ''}}">{{session.sessionName}}</span>
  &nbsp;
  <i class="fal fa-thumbtack" *ngIf="workspaceService.getWorkspace().pinned.indexOf(session.sessionId) !== -1"></i>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}" *ngIf="globalColumns.role">
  <span class="{{session.status === eSessionStatus.active ? 'strong' : ''}}">
    <ng-container *ngIf="session.type !== eSessionType.awsIamUser">{{ session | detail }}</ng-container>
  </span>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}" *ngIf="globalColumns.provider">
  <span class="badge badge-rounded badge-{{getSessionProviderClass(session.type)}}">{{getSessionProviderLabel(session.type)}}</span>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}" *ngIf="globalColumns.namedProfile">
    <span class="{{session.status === eSessionStatus.active ? 'strong' : ''}}">
      <ng-container *ngIf="session.type !== eSessionType.azure">
      {{getProfileName(getProfileId(session))}}
      <a (click)="copyProfile(getProfileName(getProfileId(session)))" tooltip="Copy Profile Name"><i class="fal fa-copy"></i></a>
      </ng-container>
    </span>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}" *ngIf="!compactMode && globalColumns.region">
  <span class="badge badge-region badge-{{session.status === eSessionStatus.active ? 'black' : 'gray'}}">{{session.region}}</span>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}">
  <i class="status-item fas fa-circle {{session.status === eSessionStatus.active ? 'active' : 'offline'}}" *ngIf="session.status !== eSessionStatus.pending"></i>
  <i class="status-item far fa-spinner-third fa-spin" *ngIf="session.status === eSessionStatus.pending"></i>
</td>



<div [matMenuTriggerFor]="menu" [style.position]="'absolute'" [style.left.px]="menuX" [style.top.px]="menuY"></div>
<mat-menu #menu>
  <span mat-menu-item class="not-displayed">dummy fix for github issue 3352</span>

  <button mat-menu-item (click)="startSession();">
    <i class="fal fa-play-circle"></i>&nbsp;
    <span>Start Session</span>
  </button>

  <div class="divider"></div>

  <button mat-menu-item (click)="changeRegionModalOpen($event, session);">
    <i class="fal fa-globe"></i>&nbsp;
    <span>Change Region</span>
  </button>
  <button mat-menu-item (click)="changeProfileModalOpen($event);">
    <i class="fal fa-user-circle"></i>&nbsp;
    <span>Change Named Profile</span>
  </button>
  <button mat-menu-item (click)="ssmModalOpen($event, session);">
    <i class="fal fa-list"></i>&nbsp;
    <span>View SSM Sessions</span>
  </button>

  <div class="divider"></div>

  <ng-container *ngIf="(session.type === eSessionType.awsIamRoleFederated || session.type === eSessionType.awsIamRoleChained || session.type === eSessionType.awsSsoRole)">
    <button mat-menu-item [matMenuTriggerFor]="change">
      <i class="fal fa-copy"></i>
      <span>&nbsp;&nbsp;&nbsp;Copy Property</span>
    </button>
    <div class="divider"></div>
  </ng-container>

  <button mat-menu-item (click)="openAmazonConsole($event, session);">
    <i class="fal fa-cloud"></i>&nbsp;
    <span>View Amazon Console</span>
  </button>
  <button mat-menu-item (click)="openTerminal($event, session);">
    <i class="fal fa-terminal"></i>&nbsp;
    <span>Open Terminal</span>
  </button>

  <div class="divider"></div>

  <button mat-menu-item (click)="editSession(session, $event);">
    <i class="fal fa-pencil"></i>&nbsp;
    <span>Edit Session</span>
  </button>

  <ng-container *ngIf="workspaceService.getWorkspace().pinned.indexOf(session.sessionId) === -1">
  <button mat-menu-item (click)="pinSession(session, $event);">
      <i class="fal fa-thumbtack"></i>&nbsp;
      <span>Pin Session</span>
  </button>
  </ng-container>

  <ng-container *ngIf="workspaceService.getWorkspace().pinned.indexOf(session.sessionId) !== -1">
  <button mat-menu-item (click)="unpinSession(session, $event);">
      <i class="fal fa-thumbtack"></i>&nbsp;
      <span>Unpin Session</span>
  </button>
  </ng-container>

  <button mat-menu-item (click)="deleteSession(session, $event);">
    <i class="fal fa-trash"></i>&nbsp;
    <span>Delete Session</span>
  </button>

</mat-menu>

<mat-menu #change>
  <button mat-menu-item (click)="copyCredentials(session, 1, $event);">
    <i class="fab fa-aws"></i>&nbsp;
    <span>Account Number</span>
  </button>
  <button mat-menu-item (click)="copyCredentials(session, 2, $event);">
    <i class="fab fa-aws"></i>&nbsp;
    <span>Role ARN</span>
  </button>
</mat-menu>

<ng-container *ngIf="eOptionIds[session.sessionId]">
  <div class="option-bar" (click)="clearOptionIds();">
    <a class="icon-button start-session" (click)="startSession();" *ngIf="session.status === eSessionStatus.inactive"><i class="fad fa-play-circle"></i>{{compactMode ? '' : '&nbsp;Start Session'}}</a>
    <a class="icon-button stop-session" (click)="stopSession();" *ngIf="session.status === eSessionStatus.active"><i class="fad fa-stop-circle"></i>{{compactMode ? '' : '&nbsp;Stop Session'}}</a>
    <div>
      <a class="icon-button" (click)="changeRegionModalOpen($event, session);" tooltip="Change Region"><i class="fal fa-globe"></i></a>
      <a class="icon-button" *ngIf="session.type !== eSessionType.azure" (click)="changeProfileModalOpen($event);" tooltip="Change Named Profile"><i class="fal fa-user-circle"></i></a>
      <a class="icon-button" (click)="ssmModalOpen($event, session);" *ngIf="session.type !== eSessionType.azure" tooltip="View SSM sessions"><i class="fal fa-list"></i></a>
      <a class="icon-button" *ngIf="session.type === eSessionType.awsIamUser && session.status !== eSessionStatus.active" (click)="editSession(session, $event);" tooltip="Edit Session"><i class="fal fa-list"></i></a>

      <span class="separator"></span>

      <a class="icon-button" (click)="pinSession(session, $event);" tooltip="Pin Session"><i class="fal fa-thumbtack"></i></a>
      <a class="icon-button" (click)="deleteSession(session, $event);" tooltip="Delete Session"><i class="fal fa-trash"></i></a>
    </div>

    <!--<div class="session-name"><strong>{{session.sessionName}}</strong><br>{{session | detail}}</div>-->
    <div class="session-name">1 selected</div>
  </div>
</ng-container>

<ng-template #ssmModalTemplate>
  <div class="modal-body">

    <a class="close-modal" (click)="modalRef.hide();">&times;</a>
    <h2>{{session.sessionName}}</h2>
    <h3>{{session | detail }}</h3>

    <div class="ssm-tray-form">

      <b>Select a Region:</b>
      <ng-select bindLabel="region" bindValue="region" [items]="awsRegions" [(ngModel)]="selectedSsmRegion" placeholder="Select a Region for finding instances" (change)="changeSsmRegion($event, session);"></ng-select>

      <div class="loader" *ngIf="ssmLoading"><i class="fa fa-spinner fa-spin"></i></div>
      <div class="list-of-ssm" *ngIf="!ssmLoading">
        <ng-container *ngIf="!ssmLoading && !firstTimeSsm">
          <b>Select an EC2 Instance:</b>
          <br>
          <input class="form-control" type="text" placeholder="searchFilter by..." (keyup)="searchSSMInstance($event)" />
        </ng-container>

        <ul class="ssm-ul" *ngIf="instances.length > 0">
          <li *ngFor="let instance of instances" class="ssm-card">
            <div>
              <span><b>{{instance.Name.length >= 24 ? instance.Name.substr(0, 21) + '...' : instance.Name}}</b> - {{instance.IPAddress}}</span>
              <button class="btn-control btn-sm" (click)="startSsmSession(session.sessionId, instance.InstanceId)">
                <i class="fa fa-spinner fa-spin" *ngIf="instance.loading"></i>
                <span *ngIf="!instance.loading">Connect</span>
              </button>
            </div>
          </li>
        </ul>
      </div>

    </div>
  </div>
</ng-template>

<ng-template #defaultRegionModalTemplate>
  <div class="modal-body">

    <a class="close-modal" (click)="modalRef.hide();">&times;</a>
    <h2>{{session.sessionName}}</h2>
    <h3>{{session | detail }}</h3>

    <div class="select-region-form">

      <b>Select a default region for the session:</b>
      <ng-select bindLabel="{{session.type === eSessionType.azure ? 'location' : 'region'}}" bindValue="{{session.type === eSessionType.azure ? 'location' : 'region'}}" [items]="regionOrLocations" [(ngModel)]="selectedDefaultRegion" placeholder="{{placeholder}}"></ng-select>

      <br>
      <button (click)="changeRegion()" [disabled]="!selectedDefaultRegion" [ngClass]="(!selectedDefaultRegion) ? 'btn-control disabled': 'btn-control'">Select</button>
      <a (click)="goBack()">Cancel</a>

    </div>
  </div>
</ng-template>

<ng-template #defaultProfileModalTemplate>
  <div class="modal-body">

    <a class="close-modal" (click)="modalRef.hide();">&times;</a>
    <h2>{{session.sessionName}}</h2>
    <h3>{{session | detail }}</h3>

    <div class="named-profile-form">

      <b>Select a profile for the session:</b>
      <ng-select bindLabel="name"
                 [addTag]="addNewProfile"
                 [items]="profiles"
                 [(ngModel)]="selectedProfile"
                 placeholder="select a profile"></ng-select>

      <br>
      <button type="button" (click)="changeProfile();" [disabled]="!selectedProfile" [ngClass]="(!selectedProfile) ? 'btn-control disabled': 'btn-control'">Save Profile</button>
      <a (click)="goBack();">Cancel</a>
    </div>
  </div>
</ng-template>
